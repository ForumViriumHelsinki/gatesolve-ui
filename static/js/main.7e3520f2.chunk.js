(this["webpackJsonpgatesolve-ui"]=this["webpackJsonpgatesolve-ui"]||[]).push([[0],{228:function(t,e,n){t.exports=n(410)},233:function(t,e,n){},278:function(t,e){},280:function(t,e){},311:function(t,e){},316:function(t,e){},326:function(t,e){},327:function(t,e){},406:function(t,e,n){},410:function(t,e,n){"use strict";n.r(e);var o,a=n(2),r=n.n(a),i=n(222),c=n.n(i),u=n(157),l=(n(233),n(37)),s=n(73),d=n(75),p=n(74),f=n(56),g=(n(236),{id:"route-line",type:"line",paint:{"line-opacity":["coalesce",["get","opacity"],.5],"line-width":5,"line-color":["get","color"]}}),h={id:"route-point",type:"circle",paint:{"circle-radius":5,"circle-color":["get","color"]},filter:["==","Point",["geometry-type"]]},m={id:"route-point-symbol",type:"symbol",paint:{"text-color":"#000","text-halo-color":"#fff","text-halo-width":3},layout:{"text-field":["get","ref"],"text-anchor":"center","text-font":["Klokantech Noto Sans Regular"],"text-size":24,"text-offset":[0,-.05]},filter:["==","Point",["geometry-type"]]},v=n(227),b=function(t){var e=t.height,n=void 0===e?"50":e,o=t.style,a=void 0===o?{fill:"#444",stroke:"none"}:o,i=t.dataTestId;return r.a.createElement("svg",{"data-testid":i,height:n,style:a,viewBox:"-1 -1 17 17"},r.a.createElement("path",{d:"M7.5 0C5.068 0 2.23 1.486 2.23 5.27c0 2.568 4.054 8.244 5.27 9.73c1.081-1.486 5.27-7.027 5.27-9.73C12.77 1.487 9.932 0 7.5 0z"}))},y=function(t){var e=t.pin,n=e.height,o=void 0===n?"50":n,a=Object(v.a)(e,["height"]),i=t.marker;return(r.a.createElement(f.b,Object.assign({},i,{offsetLeft:-o/2,offsetTop:-o}),r.a.createElement(b,Object(l.a)({height:o},a))))},O=n(5),E=n.n(O),j=n(224),T=n(13),w=n(12),S=n(26),L=n(27),P=(n(111),n(71)),_=n(10),k=n.n(_),x=n(35),R=n.n(x),C=n(24),M=n.n(C),A=n(108),D=n.n(A),N=null===(o=Object({NODE_ENV:"production",PUBLIC_URL:"/gatesolve-ui",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ROUTABLE_TILES)||void 0===o?void 0:o.replace(/\/$/,""),B=function(t){Object(L.a)(n,t);var e=Object(S.a)(n);function n(){return Object(T.a)(this,n),e.apply(this,arguments)}return Object(w.a)(n,[{key:"getIdForTileCoords",value:function(t){return"".concat(N,"/").concat(t.zoom,"/").concat(t.x,"/").concat(t.y)}}]),n}(R.a);Object({NODE_ENV:"production",PUBLIC_URL:"/gatesolve-ui",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_ROUTABLE_TILES&&(D.a.unbind(k.a.RoutableTileProvider),D.a.bind(k.a.RoutableTileProvider).to(B).inSingletonScope().whenTargetTagged("phase",M.a.Base),D.a.bind(k.a.RoutableTileProvider).to(B).inSingletonScope().whenTargetTagged("phase",M.a.Transit));var I=P.FlexibleRoadPlanner;function K(t){var e=[],n=[],o=new Map;return t.legs[0].getSteps().forEach((function(a){var r,i,c=a.stopLocation;"https://w3id.org/openstreetmap/terms#Steps"===(null===(r=t.context[a.through])||void 0===r?void 0:r.definedTags["https://w3id.org/openstreetmap/terms#highway"])&&(o.has(a.through)||o.set(a.through,[]),o.get(a.through).push([a.startLocation.longitude,a.startLocation.latitude],[a.stopLocation.longitude,a.stopLocation.latitude])),(null===(i=c.definedTags)||void 0===i?void 0:i["https://w3id.org/openstreetmap/terms#barrier"])&&(console.log(a.through,c.definedTags["https://w3id.org/openstreetmap/terms#barrier"].replace(/^.*#/,""),c.id,c.definedTags,c.freeformTags),n.push([c.longitude,c.latitude])),e.push([a.startLocation.longitude,a.startLocation.latitude]),e.push([a.stopLocation.longitude,a.stopLocation.latitude])})),[e,n,Array.from(o.values())]}function F(t,e,n,o,a,r){return{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:o||[]},properties:{color:"#000"}},{type:"Feature",geometry:{type:"MultiLineString",coordinates:r||[]},properties:{color:"#dc0451",opacity:1}},{type:"Feature",geometry:{type:"MultiPoint",coordinates:a||[]},properties:{color:"#dc0451",ref:"!"}},{type:"Feature",geometry:{type:"Point",coordinates:[t[1],t[0]]},properties:{color:"#00afff"}},{type:"Feature",geometry:{type:"Point",coordinates:[e[1],e[0]]},properties:{color:"#64be14",ref:n}}]}}function U(t,e,n){(function(t){var e,n,o=new URL("https://overpass-api.de/api/interpreter");return o.searchParams.append("data",(e=t[0],n=t[1],"\n  [out:json][timeout:25];\n  (\n    relation(around:10, ".concat(e,", ").concat(n,")[building];\n    way(r);\n    way(around:10, ").concat(e,", ").concat(n,")[building];\n  )->.b;\n  // gather results\n  (\n    node(w.b)[entrance];\n  );\n  // print results\n  out body;\n  >;\n  out skel qt;\n"))),fetch(o.toString()).then((function(t){return t.json().then((function(t){return t.elements.filter((function(t){return"node"===t.type&&"lat"in t&&null!=t.lat&&"lon"in t&&null!=t.lon&&t.tags&&t.tags.entrance}))}))}))})(e).then((function(t){return t.length?t:[{id:-1,type:"node",lat:e[0],lon:e[1]}]})).then((function(e){e.forEach((function(e){var o=new I;o.query({from:{latitude:t[0],longitude:t[1]},to:{latitude:e.lat,longitude:e.lon}}).take(1).on("data",function(){var a=Object(j.a)(E.a.mark((function a(r){var i,c,u,l,d,p,f,g,h;return E.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o.completePath(r);case 2:u=a.sent,console.log("Plan",u,"from",t,"to",e),l=K(u),d=Object(s.a)(l,3),p=d[0],f=d[1],g=d[2],h=F(t,[e.lat,e.lon],(null===(i=e.tags)||void 0===i?void 0:i.ref)||(null===(c=e.tags)||void 0===c?void 0:c["addr:unit"]),p,f,g),n(h);case 7:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}())}))}))}n(406);var W=[60.16295,24.93071],H=[60.16259,24.93155],z={origin:W,destination:H,route:F(W,H),viewport:{latitude:60.163,longitude:24.931,zoom:16,bearing:0,pitch:0}},q=function(t){if(!t)throw Error("This cannot happen as URL isn't actually optional.");return{url:t.replace("https://static.hsldev.com/mapfonts/Klokantech Noto Sans","https://fonts.openmaptiles.org/Klokantech Noto Sans")}},V=function(t){return t.split(",").map(Number)},J=function(){var t=Object(a.useRef)(null),e=Object(a.useRef)({}),n=Object(p.e)({path:"/route/:from/:to"}),o=Object(a.useState)(z),i=Object(s.a)(o,2),c=i[0],u=i[1];Object(a.useEffect)((function(){if(n){var t=V(n.params.from),o=V(n.params.to),a=function(t,e){var n=new f.d(t),o=Math.min.apply(Math,Object(d.a)(e.map((function(t){return t[1]})))),a=Math.max.apply(Math,Object(d.a)(e.map((function(t){return t[1]})))),r=Math.min.apply(Math,Object(d.a)(e.map((function(t){return t[0]})))),i=Math.max.apply(Math,Object(d.a)(e.map((function(t){return t[0]}))));return n.fitBounds([[o,r],[a,i]],{padding:40})}(e.current,[t,o]);u((function(n){return Object(l.a)({},n,{origin:t,destination:o,viewport:Object(l.a)({},e.current,{},a)})}))}}),[]);var v=Object(p.d)();return Object(a.useEffect)((function(){v.location.pathname!=="/route/".concat(c.origin,"/").concat(c.destination,"/")&&v.replace("/route/".concat(c.origin,"/").concat(c.destination,"/"))}),[v,c.origin,c.destination]),Object(a.useEffect)((function(){u((function(t){return Object(l.a)({},t,{route:F(c.origin,c.destination)})})),U(c.origin,c.destination,(function(t){u((function(e){var n;return c.origin!==e.origin||c.destination!==e.destination?e:((n=t.features).push.apply(n,Object(d.a)(e.route.features)),Object(l.a)({},e,{route:t}))}))}))}),[c.origin,c.destination]),r.a.createElement("div",{"data-testid":"app",className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h2",null,"Gatesolve")),r.a.createElement(f.e,Object.assign({ref:t},c.viewport,{width:"100%",height:"90%",mapStyle:"https://raw.githubusercontent.com/HSLdevcom/hsl-map-style/master/simple-style.json",transformRequest:q,onViewportChange:function(t){e.current=t,u((function(e){return Object(l.a)({},e,{viewport:t})}))},onClick:function(t){0===t.srcEvent.button&&u((function(e){return Object(l.a)({},e,{destination:[t.lngLat[1],t.lngLat[0]]})}))},onContextMenu:function(t){u((function(e){return Object(l.a)({},e,{origin:[t.lngLat[1],t.lngLat[0]]})})),t.srcEvent.preventDefault()}}),r.a.createElement(f.c,{type:"geojson",data:c.route},r.a.createElement(f.a,g),r.a.createElement(f.a,h),r.a.createElement(f.a,m)),r.a.createElement(y,{marker:{draggable:!0,onDragEnd:function(t){u((function(e){return Object(l.a)({},e,{origin:[t.lngLat[1],t.lngLat[0]]})}))},longitude:c.origin[1],latitude:c.origin[0]},pin:{dataTestId:"origin",style:{fill:"#00afff",stroke:"#fff"}}}),r.a.createElement(y,{marker:{draggable:!0,onDragEnd:function(t){u((function(e){return Object(l.a)({},e,{destination:[t.lngLat[1],t.lngLat[0]]})}))},longitude:c.destination[1],latitude:c.destination[0]},pin:{dataTestId:"destination",style:{fill:"#64be14",stroke:"#fff"}}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,null,r.a.createElement(J,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[228,1,2]]]);
//# sourceMappingURL=main.7e3520f2.chunk.js.map